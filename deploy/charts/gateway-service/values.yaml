replicaCount: 1

image:
  repository: harbor.g-oss.top/astraios/gateway-service
  tag: "latest"
  pullPolicy: Always
imagePullSecrets:
  - name: harbor-credential

service:
  type: ClusterIP
  port: 8888

probes:
  liveness:
    enabled: true
    tcpSocket:
      port: 8888
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 2
    failureThreshold: 3
    successThreshold: 1
  readiness:
    enabled: true
    tcpSocket:
      port: 8888
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 2
    failureThreshold: 3
    successThreshold: 1

config:
  name: gateway
  host: 0.0.0.0
  port: 8888
  userService:
    endpoints:
      - user-service:8080
    timeout: 2000
    nonBlock: true
    middlewares:
      breaker: true
  authService:
    endpoints:
      - auth-service:9091
    timeout: 2000
    nonBlock: true
    middlewares:
      breaker: true
  jwtAuth:
    issuer: astraios
    cacheSeconds: 300

ingress:
  enabled: true
  className: nginx
  annotations:
    # Forward /api/* requests to gateway-service without rewriting
    # gateway-service handles /api prefix internally
  hosts:
    - host: astraios.g-oss.top
      paths:
        - path: /api
          pathType: Prefix
  
  # Canary (灰度发布) 配置
  # 用于将部分流量路由到新版本（如 v2）
  canary:
    enabled: false
    # 灰度方式：weight (按权重) 或 header (按请求头)
    type: weight  # weight | header
    # 权重灰度：0-100，表示灰度流量百分比
    weight: 10    # 10% 流量到 canary 版本
    # Header 灰度：匹配特定 header 的请求才走灰度
    # header:
    #   name: X-Canary
    #   value: "true"
    # 灰度服务名称（通常是 gateway-service-canary）
    serviceName: gateway-service-canary
    servicePort: 8888
  # TLS is handled globally by ingress-nginx-custom's default-ssl-certificate.
  # Uncomment below only if you need a domain-specific certificate.
  # tls:
  #   - hosts:
  #       - astraios.g-oss.top
  #     secretName: astraios-tls

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi
nodeSelector: {}
tolerations: []
affinity: {}
