# Custom values for ingress-nginx.
# This chart depends on the official ingress-nginx chart.

ingress-nginx:
  controller:
    # 核心配置：设置默认 SSL 证书
    # 格式为: <namespace>/<secret-name>
    extraArgs:
      default-ssl-certificate: "ingress-nginx/global-tls"

    # 明确设置 IngressClass 资源，避免使用已废弃的 controller.ingressClass 字符串配置
    ingressClassResource:
      name: nginx
      enabled: true
      default: false
      controllerValue: "k8s.io/ingress-nginx"

    # 镜像配置：使用国内镜像源解决拉取失败问题
    image:
      registry: registry.lank8s.cn
      image: ingress-nginx/controller
      digest: ""

    admissionWebhooks:
      enabled: true
      patch:
        enabled: true
        image:
          registry: registry.lank8s.cn
          image: ingress-nginx/kube-webhook-certgen
          digest: ""

    # Nginx 配置
    config:
      # 强制 HTTP 重定向到 HTTPS
      ssl-redirect: "true"
      force-ssl-redirect: "true"
      # 确保后端收到的协议头正确
      use-forwarded-headers: "true"
      # 设置代理超时等（可选）
      proxy-body-size: "20m"

    # 服务配置
    service:
      enabled: true
      type: LoadBalancer
      # 如果需要固定端口或特定注解，可以在此处添加
      annotations: {}

    # 准入控制（通常建议开启） - 已在上方配置
    # admissionWebhooks:
    #   enabled: true

    # 资源限制
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi

  # 默认不安装默认后端，除非有特殊需求
  defaultBackend:
    enabled: false
